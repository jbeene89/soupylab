<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ground Effect Vehicle - WebAssembly</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, #0a1e27 0%, #0e2a3a 50%, #1a2f3a 100%);
            color: #e0e0e0;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(90deg, rgba(0, 191, 255, 0.2), rgba(30, 144, 255, 0.2));
            padding: 20px;
            border-bottom: 2px solid rgba(0, 191, 255, 0.5);
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            font-weight: 900;
            background: linear-gradient(90deg, #00bfff 0%, #1e90ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 191, 255, 0.5);
        }

        .subtitle {
            color: #888;
            font-size: 0.9em;
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
            padding: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(10, 20, 30, 0.8);
            border: 1px solid rgba(0, 191, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 191, 255, 0.2);
        }

        .panel h2 {
            color: #00bfff;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid rgba(0, 191, 255, 0.3);
            padding-bottom: 10px;
        }

        .canvas-container {
            position: relative;
            background: rgba(5, 10, 15, 0.9);
            border: 2px solid rgba(0, 191, 255, 0.4);
            border-radius: 10px;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            color: #00bfff;
            margin-bottom: 5px;
            font-size: 0.85em;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(0, 191, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00bfff, #1e90ff);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.8);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00bfff, #1e90ff);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.8);
        }

        .value-display {
            display: inline-block;
            float: right;
            color: #1e90ff;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: linear-gradient(135deg, #00bfff, #1e90ff);
            border: none;
            border-radius: 5px;
            color: #0a0e27;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 191, 255, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 191, 255, 0.5);
        }

        button:active {
            transform: translateY(0);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(0, 191, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-label {
            color: #888;
            font-size: 0.75em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #1e90ff;
            font-size: 1.3em;
            font-weight: bold;
        }

        .stat-unit {
            color: #666;
            font-size: 0.8em;
            margin-left: 3px;
        }

        .force-display {
            background: rgba(0, 191, 255, 0.05);
            border: 1px solid rgba(0, 191, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .force-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.9em;
        }

        .force-label {
            color: #888;
        }

        .force-value {
            color: #00bfff;
            font-weight: bold;
        }

        .effect-meter {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 191, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .effect-fill {
            height: 100%;
            background: linear-gradient(90deg, #00bfff, #00ff00);
            transition: width 0.3s;
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
        }

        .scenario-btn {
            padding: 8px;
            font-size: 0.9em;
            margin: 3px 0;
        }

        .warning {
            color: #ffaa00;
            font-size: 0.9em;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid rgba(255, 170, 0, 0.3);
            border-radius: 5px;
            display: none;
        }

        .warning.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåä GROUND EFFECT VEHICLE SIMULATOR</h1>
        <p class="subtitle">Wing-in-Ground Effect ‚Ä¢ Ekranoplan Dynamics ‚Ä¢ RAM Pressure ‚Ä¢ Wave Interaction ‚Ä¢ C++ WebAssembly</p>
    </div>

    <div class="container">
        <!-- Left Panel: Controls -->
        <div class="panel">
            <h2>Vehicle Controls</h2>

            <div class="control-group">
                <label>
                    Throttle
                    <span class="value-display" id="throttleValue">70%</span>
                </label>
                <input type="range" id="throttleSlider" min="0" max="100" step="5" value="70">
            </div>

            <div class="control-group">
                <label>
                    Pitch
                    <span class="value-display" id="pitchValue">3.0¬∞</span>
                </label>
                <input type="range" id="pitchSlider" min="-5" max="10" step="0.5" value="3">
            </div>

            <div class="control-group">
                <label>
                    Initial Height
                    <span class="value-display" id="heightValue">3.0 m</span>
                </label>
                <input type="range" id="heightSlider" min="1" max="20" step="0.5" value="3">
            </div>

            <button id="resetBtn">üîÑ Reset Flight</button>

            <h2 style="margin-top: 20px;">Wave Conditions</h2>

            <div class="control-group">
                <label>
                    Wave Height
                    <span class="value-display" id="waveHeightValue">0.5 m</span>
                </label>
                <input type="range" id="waveHeightSlider" min="0" max="3" step="0.1" value="0.5">
            </div>

            <div class="control-group">
                <label>
                    Wavelength
                    <span class="value-display" id="wavelengthValue">20 m</span>
                </label>
                <input type="range" id="wavelengthSlider" min="5" max="50" step="5" value="20">
            </div>

            <h2 style="margin-top: 20px;">Scenarios</h2>
            <button class="scenario-btn" id="calmSeaBtn">Calm Sea (0.3m waves)</button>
            <button class="scenario-btn" id="moderateBtn">Moderate (1.5m waves)</button>
            <button class="scenario-btn" id="roughBtn">Rough Seas (3m waves)</button>
            <button class="scenario-btn" id="highAltBtn">Out of Ground Effect</button>

            <div class="warning" id="heightWarning">
                ‚ö†Ô∏è Too low - Risk of water contact!
            </div>
        </div>

        <!-- Center: Canvas -->
        <div class="panel" style="padding: 0;">
            <div class="canvas-container">
                <canvas id="ekranoplanCanvas" width="1000" height="600"></canvas>
            </div>
        </div>

        <!-- Right Panel: Statistics -->
        <div class="panel">
            <h2>Flight Data</h2>

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="stat-label">VELOCITY</div>
                    <div class="stat-value">
                        <span id="velocityStat">50</span>
                        <span class="stat-unit">m/s</span>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">HEIGHT AGL</div>
                    <div class="stat-value">
                        <span id="heightStat">3.0</span>
                        <span class="stat-unit">m</span>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">CLIMB RATE</div>
                    <div class="stat-value">
                        <span id="climbStat">0.0</span>
                        <span class="stat-unit">m/s</span>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">L/D RATIO</div>
                    <div class="stat-value">
                        <span id="ldRatioStat">15.0</span>
                        <span class="stat-unit">:1</span>
                    </div>
                </div>
            </div>

            <h2 style="margin-top: 20px;">Force Balance</h2>

            <div class="force-display">
                <div class="force-row">
                    <span class="force-label">Lift:</span>
                    <span class="force-value" id="liftForce">3000 kN</span>
                </div>
                <div class="force-row">
                    <span class="force-label">Drag:</span>
                    <span class="force-value" id="dragForce">200 kN</span>
                </div>
                <div class="force-row">
                    <span class="force-label">Thrust:</span>
                    <span class="force-value" id="thrustForce">250 kN</span>
                </div>
            </div>

            <h2 style="margin-top: 20px;">Ground Effect</h2>

            <div class="force-display">
                <div class="force-row">
                    <span class="force-label">Effect Factor:</span>
                    <span class="force-value" id="effectFactor">85%</span>
                </div>
                <div class="effect-meter">
                    <div class="effect-fill" id="effectBar" style="width: 85%;"></div>
                </div>

                <div class="force-row" style="margin-top: 15px;">
                    <span class="force-label">RAM Pressure:</span>
                    <span class="force-value" id="ramPressure">500 Pa</span>
                </div>
            </div>

            <h2 style="margin-top: 20px;">Mission Stats</h2>

            <div class="stat-grid">
                <div class="stat-box">
                    <div class="stat-label">MAX SPEED</div>
                    <div class="stat-value">
                        <span id="maxSpeedStat">50</span>
                        <span class="stat-unit">m/s</span>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">MIN HEIGHT</div>
                    <div class="stat-value">
                        <span id="minHeightStat">3.0</span>
                        <span class="stat-unit">m</span>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">DISTANCE</div>
                    <div class="stat-value">
                        <span id="distanceStat">0.0</span>
                        <span class="stat-unit">km</span>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">FUEL USED</div>
                    <div class="stat-value">
                        <span id="fuelStat">0</span>
                        <span class="stat-unit">kg</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import createEkranoplanModule from './ground_effect_engine.js';

        let Module, ekranoplan;
        let canvas, ctx;
        let isRunning = false;

        async function init() {
            try {
                Module = await createEkranoplanModule();
                ekranoplan = new Module.Ekranoplan();

                canvas = document.getElementById('ekranoplanCanvas');
                ctx = canvas.getContext('2d');

                setupControls();
                animate();
                isRunning = true;

                console.log('üåä Ekranoplan initialized');
            } catch (error) {
                console.error('Failed to initialize:', error);
                canvas = document.getElementById('ekranoplanCanvas');
                ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ff4444';
                ctx.font = '20px Orbitron';
                ctx.fillText('WebAssembly module not found', 50, 50);
                ctx.font = '14px Orbitron';
                ctx.fillText('Compile ground_effect_engine.cpp with Emscripten first', 50, 80);
            }
        }

        function setupControls() {
            const throttleSlider = document.getElementById('throttleSlider');
            const pitchSlider = document.getElementById('pitchSlider');
            const heightSlider = document.getElementById('heightSlider');
            const waveHeightSlider = document.getElementById('waveHeightSlider');
            const wavelengthSlider = document.getElementById('wavelengthSlider');
            const resetBtn = document.getElementById('resetBtn');

            throttleSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                ekranoplan.setThrottle(value / 100);
                document.getElementById('throttleValue').textContent = value + '%';
            });

            pitchSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                ekranoplan.setPitch(value);
                document.getElementById('pitchValue').textContent = value.toFixed(1) + '¬∞';
            });

            heightSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                document.getElementById('heightValue').textContent = value.toFixed(1) + ' m';
            });

            waveHeightSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                ekranoplan.setWaveHeight(value);
                document.getElementById('waveHeightValue').textContent = value.toFixed(1) + ' m';
            });

            wavelengthSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                ekranoplan.setWavelength(value);
                document.getElementById('wavelengthValue').textContent = value + ' m';
            });

            resetBtn.addEventListener('click', () => {
                ekranoplan.reset();
                ekranoplan.setHeight(parseFloat(heightSlider.value));
                ekranoplan.setThrottle(parseFloat(throttleSlider.value) / 100);
                ekranoplan.setPitch(parseFloat(pitchSlider.value));
                ekranoplan.setWaveHeight(parseFloat(waveHeightSlider.value));
                ekranoplan.setWavelength(parseFloat(wavelengthSlider.value));
            });

            document.getElementById('calmSeaBtn').addEventListener('click', () => {
                waveHeightSlider.value = 0.3;
                wavelengthSlider.value = 15;
                ekranoplan.setWaveHeight(0.3);
                ekranoplan.setWavelength(15);
                updateSliderDisplays();
            });

            document.getElementById('moderateBtn').addEventListener('click', () => {
                waveHeightSlider.value = 1.5;
                wavelengthSlider.value = 25;
                ekranoplan.setWaveHeight(1.5);
                ekranoplan.setWavelength(25);
                updateSliderDisplays();
            });

            document.getElementById('roughBtn').addEventListener('click', () => {
                waveHeightSlider.value = 3.0;
                wavelengthSlider.value = 40;
                ekranoplan.setWaveHeight(3.0);
                ekranoplan.setWavelength(40);
                updateSliderDisplays();
            });

            document.getElementById('highAltBtn').addEventListener('click', () => {
                heightSlider.value = 20;
                ekranoplan.reset();
                ekranoplan.setHeight(20);
                updateSliderDisplays();
            });
        }

        function updateSliderDisplays() {
            document.getElementById('waveHeightValue').textContent = waveHeightSlider.value + ' m';
            document.getElementById('wavelengthValue').textContent = wavelengthSlider.value + ' m';
            document.getElementById('heightValue').textContent = heightSlider.value + ' m';
        }

        function animate() {
            if (!isRunning) return;

            // Update physics
            for (let i = 0; i < 3; i++) {
                ekranoplan.update(0.05);
            }

            updateStats();
            drawScene();

            requestAnimationFrame(animate);
        }

        function updateStats() {
            const velocity = ekranoplan.getVelocity();
            const height = ekranoplan.getHeight();
            const climbRate = ekranoplan.getVerticalSpeed();
            const ldRatio = ekranoplan.getLiftToDragRatio();

            const lift = ekranoplan.getLift();
            const drag = ekranoplan.getDrag();
            const thrust = ekranoplan.getThrust();

            const effectFactor = ekranoplan.getGroundEffectFactor();
            const ramPressure = ekranoplan.getRAMPressure();

            // Update displays
            document.getElementById('velocityStat').textContent = velocity.toFixed(0);
            document.getElementById('heightStat').textContent = height.toFixed(1);
            document.getElementById('climbStat').textContent = climbRate.toFixed(1);
            document.getElementById('ldRatioStat').textContent = ldRatio.toFixed(1);

            document.getElementById('liftForce').textContent = lift.toFixed(0) + ' kN';
            document.getElementById('dragForce').textContent = drag.toFixed(0) + ' kN';
            document.getElementById('thrustForce').textContent = thrust.toFixed(0) + ' kN';

            document.getElementById('effectFactor').textContent = (effectFactor * 100).toFixed(0) + '%';
            document.getElementById('effectBar').style.width = (effectFactor * 100) + '%';
            document.getElementById('ramPressure').textContent = ramPressure.toFixed(0) + ' Pa';

            document.getElementById('maxSpeedStat').textContent = ekranoplan.getMaxSpeed().toFixed(0);
            document.getElementById('minHeightStat').textContent = ekranoplan.getMinHeight().toFixed(1);
            document.getElementById('distanceStat').textContent = ekranoplan.getTotalDistance().toFixed(1);
            document.getElementById('fuelStat').textContent = ekranoplan.getFuelUsed().toFixed(0);

            // Height warning
            const heightWarning = document.getElementById('heightWarning');
            if (height < 1.5) {
                heightWarning.classList.add('active');
            } else {
                heightWarning.classList.remove('active');
            }
        }

        function drawScene() {
            const w = canvas.width;
            const h = canvas.height;

            // Clear with gradient (sky to water)
            const gradient = ctx.createLinearGradient(0, 0, 0, h);
            gradient.addColorStop(0, '#1a3a4a');
            gradient.addColorStop(0.6, '#2a5a7a');
            gradient.addColorStop(1, '#0a2a3a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, w, h);

            // Water line reference
            const waterLine = h * 0.65;

            // Draw waves
            const waveProfile = ekranoplan.getWaveProfile(200);
            ctx.strokeStyle = '#00bfff';
            ctx.lineWidth = 3;
            ctx.beginPath();

            for (let i = 0; i < waveProfile.length / 2; i++) {
                const xPos = waveProfile[i * 2];
                const waveH = waveProfile[i * 2 + 1];

                const canvasX = (i / (waveProfile.length / 2)) * w;
                const canvasY = waterLine - waveH * 20;

                if (i === 0) {
                    ctx.moveTo(canvasX, canvasY);
                } else {
                    ctx.lineTo(canvasX, canvasY);
                }
            }
            ctx.stroke();

            // Fill water below waves
            ctx.lineTo(w, h);
            ctx.lineTo(0, h);
            ctx.closePath();
            ctx.fillStyle = 'rgba(10, 42, 58, 0.8)';
            ctx.fill();

            // Draw trail
            const trail = ekranoplan.getTrail();
            const trailLen = trail.length / 2;

            if (trailLen > 1) {
                ctx.strokeStyle = 'rgba(0, 191, 255, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();

                for (let i = Math.max(0, trailLen - 300); i < trailLen; i++) {
                    const x = trail[i * 2];
                    const y = trail[i * 2 + 1];

                    const canvasX = ((i - (trailLen - 1)) * 2 + 200) * 3;
                    const canvasY = waterLine - y * 10;

                    if (i === Math.max(0, trailLen - 300)) {
                        ctx.moveTo(canvasX, canvasY);
                    } else {
                        ctx.lineTo(canvasX, canvasY);
                    }
                }
                ctx.stroke();
            }

            // Draw ekranoplan
            const vehicleX = w / 2;
            const vehicleY = waterLine - ekranoplan.getY() * 10;

            ctx.save();
            ctx.translate(vehicleX, vehicleY);
            ctx.rotate(ekranoplan.getPitch() * Math.PI / 180);

            // Ground effect visualization (cushion)
            const effectFactor = ekranoplan.getGroundEffectFactor();
            if (effectFactor > 0.3) {
                const cushionGrad = ctx.createRadialGradient(0, 10, 0, 0, 10, 60);
                cushionGrad.addColorStop(0, `rgba(0, 255, 255, ${0.3 * effectFactor})`);
                cushionGrad.addColorStop(1, 'rgba(0, 255, 255, 0)');
                ctx.fillStyle = cushionGrad;
                ctx.beginPath();
                ctx.ellipse(0, 10, 80, 30, 0, 0, Math.PI * 2);
                ctx.fill();
            }

            // Vehicle body
            ctx.fillStyle = '#00bfff';
            ctx.shadowColor = '#00bfff';
            ctx.shadowBlur = 15;

            // Fuselage
            ctx.beginPath();
            ctx.ellipse(0, 0, 60, 12, 0, 0, Math.PI * 2);
            ctx.fill();

            // Wings (large span)
            ctx.fillStyle = '#1e90ff';
            ctx.beginPath();
            ctx.moveTo(-10, 0);
            ctx.lineTo(-100, 5);
            ctx.lineTo(-90, -3);
            ctx.lineTo(-5, -2);
            ctx.closePath();
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(-10, 0);
            ctx.lineTo(-100, -5);
            ctx.lineTo(-90, 3);
            ctx.lineTo(-5, 2);
            ctx.closePath();
            ctx.fill();

            // Tail
            ctx.fillStyle = '#00bfff';
            ctx.beginPath();
            ctx.moveTo(-50, 0);
            ctx.lineTo(-70, -15);
            ctx.lineTo(-65, -5);
            ctx.closePath();
            ctx.fill();

            ctx.restore();

            // Display info
            ctx.fillStyle = '#00bfff';
            ctx.font = '14px Orbitron';
            ctx.fillText(`Height: ${ekranoplan.getHeight().toFixed(1)}m`, 10, 30);
            ctx.fillText(`Velocity: ${ekranoplan.getVelocity().toFixed(0)}m/s`, 10, 50);
            ctx.fillText(`Ground Effect: ${(effectFactor * 100).toFixed(0)}%`, 10, 70);
        }

        init();
    </script>
</body>
</html>
